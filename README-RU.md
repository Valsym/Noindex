# Noindex Project<br>

Данный проект был реализован 08-авг-2017 г.<br>
Суть проекта: <br>
Веб-сайт http://fanski.ru находящийся в биржах по продаже сео-ссылок GGL, Miralink, Rotapost попал под фильтр Яндекса.<br>
АГС-2015 накладывается за чрезмерное количество SEO-ссылок на сайте. Сайт потерял большую часть поискового трафика, и у него обнулился тИЦ.<br>
Согласно рекомендациям поступившим с биржи GoGetLinks:<br>
"Ссылки, которые размещены через Gogetlinks, нужно закрыть тегами noindex. Также необходимо убрать у этих ссылок анкоры, чтобы остался голый URL (безанкорная ссылка)."
<br> 
Закрытие ссылок тэгами <noindex></noindex> не представляет сложностей.<br>
Таким образом, главной задачей была переделка анкоров ссылок в безанкорные во всех статьях, размещенных на сайте. За все  время сущетвования сайта таких ссылок было размещено довольно большое количество и вручную переделывать анкоры заняло бы слишком долгое время.

Для решения задачи были написаны два скрипта: replaceAnchor.php - для замены анкоров биржы GGL и replaceAnchor-rota.php - для ссылок с Ротапост и Миралинкс.

Сайт написан на Worpress, поэтому для модификации статей с сео-ссылками использовался тот же подход, что и в проектах https://github.com/Valsym/parser-autoposter и https://github.com/Valsym/railway.


Скрипты на php (см. файлы replaceAnchor.php и replaceAnchor-rota.php)  запускались на хостиге вручную прямо из браузера.<br> 
   *****************************************************************************************
   Скрипты генерируют не просто html-код (это-то довольно просто), а страницы в формате CMS Wordpress, что и составляло главную проблему. Однако, как всегда, удалось её решить. <br>
   Таким образом, сначала читался контент из статей, на которых были размещены сео-ссылки, затем переделывались анкоры и бывший анкор помещался снаружи ссылки, прямо перед ней. После чего обновленный контнт перезаписывался в Базу Даннных сайта.<br>
   *****************************************************************************************
   Список урлов статей, на которых были размещены сео-ссылки, а также сами требуемые ссылки на сайты оптимизаторов и анкоры в удобоном формате csv предоставляют сами биржы GGL, Miralinks. Биржа Ротапост такой файл с урлами и анкорами не предоставляет (но на ней было размещено минимальное кол-во ссылок, поэтому составить такой список вручную не составило труда).
   ************************************************************************************
<b>Несколько слов об алгоритме.</b><br>
После считывания ЧПУ-урла из файла ggl.cvs, для дальнейшей работы из него необходимо получить ID статьи (поста): <br>
$postid = url_to_postid( $url );<br>

Далее можно прочитать всю необходимую инфу из соответствующей строки БД Вордпресс по ID:<br>
$post = get_post( $postid );<br>
Тут $post - это ассоциативный массив, в частности содержащий тело поста $content = $post->post_content;

Далее вызывается функция replaceAnchor():<br>
$ncontent = replaceAnchor($content, $url2); <br>
которая собственно и меняет анкор на безанкор и ставит анкор снаружи сео-ссылки.

И в конце идет перезапись контента поста:<br>
$post->post_content = $ncontent;<br>
$post_id = wp_update_post( $post );

После чего переходим к следующей записи в главном цикле.
	
В функции replaceAnchor я решил не использовать регулярные выражения или ноды DOMа для поиска подстроки<br> с анкором и сео-ссылкой, а воспользовался более простим и понятным (для меня) поиском с помощью<br> strpos, strripos, substr и заменой str_replace.

В случае, когда анкор изначально был безанкорным: <br>
if (strpos($anchor, 'http://') !== false) {...},<br>
то такой контент поста не изменялся и осуществлялся переход к следующему шагу главного цикла.
	
*********************************************************************************************************	
Скрипт для бирж Миралинкс и Ротапост replaceAnchor-rota.php был немного видоизменен, поскольку: <br>
1. в Миралинкс иногда размещались сразу две сео-ссылки на статью. <br>
2. в обоих этих биржах структура ссылок отличалась от ГоГетЛинкс (в тегах \<a .../a\> всегда присутствовал атрибут title перед href).
   
*********************************************************************************************************

